<%= render "home/menu" %>

<style type="text/css">
  p{ 
	font-size: 17px;
	margin-left: 15px;
  }	
</style>

<div class="row" style="
	padding: 50px; 
	padding-top: 5px;
	padding-bottom: 5px;
	background-color: #D8D8D8; 
	margin-right:30px; 
	margin-left:30px;
	margin-bottom: 20px;"
>     
	<div class="row">
		<div class="col-md-10">
			<h2><%= @couch.titulo %></h2>
		</div>
		<div class="col-md-2" style="margin-top: 10px">
		<% if current_user  %>
			<% if can? :update, @couch %>
			<%= link_to "Editar", edit_couch_path(@couch), class: 'btn btn-info btn-lg' %>
			<% else %>
				<%= link_to "Reservar", reservation_path, class: 'btn btn-success btn-lg' %>
			<% end %>
		<% end %>
		</div>
	</div>

	<div class="row" style="background-color:#F2F2F2">
	  	<div class="row">
	  		<div class="col-md-4" >
	  		<%= image_tag @couch.url_foto , :alt => "Foto",  
	  			height: 'auto', width: '315', style:"margin-top:30px;" %>
	  		</div>
	  		<div class="col-md-8">
	  		<div class="row">
	  		<div class="col-md-12" style="margin-top: 20px">
	  			<p><i>Descripción:  </i><b><%= @couch.descripcion %></b></p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p>
	  		<i>Tipo:</i>
	  		<%= CouchType.find( @couch.couch_type_id).titulo %>
	  		</p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12"><p><i>Capacidad:</i> <%= @couch.capacity %> </p></div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p><i>Ubicación:</i>  <%= @couch.location %> </p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p><i>Estado: </i><%= (@couch.enable) ? "Disponible" : "No Disponible"  %></p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p><i>Fecha inicio: </i><%= @couch.avivable_in_date %></p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p><i>Fecha final: </i><%= @couch.avivable_out_date %></p>
	  		</div>
	  	</div>
	  	<div class="row">
	  		<div class="col-md-12">
	  		<p><i>Propietario:</i>
	  		<%= link_to User.find( @couch.user_id ).first_name , User.find(@couch.user_id) %>
	  		</p>
	  		</div>
	  	</div>
	</div>
	</div>
	</div>
</div>

<!-- CALIFICACIONES DEL COUCH ACTUAL -->

<div class="row" style="
	padding: 50px; 
	padding-top: 5px;
	padding-bottom: 5px;
	background-color: #D8D8D8; 
	margin-right:30px; 
	margin-left:30px;
	margin-top: 15px;
	margin-bottom:20px;"
>     
	<div class="row">
		<div class="col-md-12"><h2>Calificación</h2></div>
	</div>

	<div class="row" style="background-color:#F2F2F2">
		<div class="col-md-12">
			
		</div>
	</div>
</div>


<!-- SOLICITUDES DE RESERVA PARA EL COUCH ACTUAL -->

<% if current_user and current_user.id == @couch.user_id %>
<div class="row" style="
	padding: 50px; 
	padding-top: 5px;
	padding-bottom: 5px;
	background-color: #D8D8D8; 
	margin-right:30px; 
	margin-left:30px;
	margin-top: 15px;
	margin-bottom:40px;"
>     
	<div class="row">
		<div class="col-md-12"><h2>Solicitudes de Reserva</h2></div>
	</div>

	<div class="row" style="background-color:#F2F2F2">
		<div class="col-md-12">
			<table class="table">
   <tr>
       <td>Usuario</td>
       <td>Fecha Inicio</td>
       <td>Fecha Final</td>
       <td>Couch</td>
       <td></td>
       <td></td>
   </tr>
   <%  
   Reservation.all.each do |res|  
       if (Couch.find(res.couch_id).user.id == current_user.id) and (res.couch_id == @couch.id)
   %>
       <tr>
          <td>
        <%= link_to User.find(res.user_id).first_name, User.find(res.user_id)  %>
          </td>
          <td>
        <%= res.start_date %>
          </td>
          <td>
        <%= res.end_date %>
          </td>
          <td>
        <%= link_to Couch.find(res.couch_id).titulo, Couch.find(res.couch_id) %>
          </td>
          <% if res.is_pendiente? %> 
          	<td>
        		<%= link_to "Aceptar",  edit_reservation_path(res) , class: 'btn btn-success btn-sm' %>
          	</td>
         	<td>
        	<%= link_to "Rechazar", res, method: :delete, class: 'btn btn-danger btn-sm' %>
         	</td>
         <% else %>
            <td><%= res.estado %></td>
            <td></td>
         <% end %>
   <% end end %>
</table>
		</div>
	</div>
</div>
<% end %>

<div class="col-xs-12">
  <h2>¿Preguntas?</h2>
   	<%  @couch.comentarios.each do |com|  %>
   	<br>
   	<div class="col-xs-12" style="background-color: #F0F0F0;box-shadow: 2px 2px 2px #888888;border-radius: 4px;margin-bottom: 24px;padding: 16px;">
   		<h4>
   			<%= User.find(com.user_id).first_name %>
   		</h4>
   		<%= com.body %>
   		<br>
   		<% if (com.respondido) %>
   		<div style="padding-top: 18px;padding-left: 50px;">
   			<%= com.respuesta %>
   		</div>
   			
   		<% else %>
   		<% if current_user and can? :update, @couch %>
   		<form action="/comentario/edit" method="get">
         	<input type="text" name="id" hidden required value= <%= com.id %> >
   		<tr>
      		<td>
      			<textarea name="respuesta" rows="4"  class="form-control" placeholder="Ingrese la respuesta"></textarea>
      		</td>
      	</tr>
      	<tr>
      		<td>
      			<button type="submit" class="btn btn-success">Responder</button>
      		</td>
      	</tr>
      	</form>
		<% end %>
		<% end %>

   	</div>
   	<% end %>

    <div>
      <form action="/comentario/new" method="get"> 
      	<input type="text" name="user_id" hidden required value= <%= current_user.id %> >
      	<input type="text" name="couch_id" hidden required value= <%= @couch.id %> >
      	<tr>
      		<td>
      			<textarea name="body" rows="4"  class="form-control" placeholder="Ingrese la pregunta"></textarea>
      		</td>
      	</tr>
      	<br>
      	<tr>
      		<td>
      			<button type="submit" class="btn btn-info">Postear</button>
      		</td>
      	</tr>
      </form>
    </div>
        
      </div>
      
    </div>
  </div>
</div>






